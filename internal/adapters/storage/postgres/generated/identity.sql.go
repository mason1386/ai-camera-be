// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: identity.sql

package generated

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countIdentities = `-- name: CountIdentities :one
SELECT COUNT(*) FROM identities
WHERE deleted_at IS NULL
`

func (q *Queries) CountIdentities(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countIdentities)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createIdentity = `-- name: CreateIdentity :one
INSERT INTO identities (
    code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8, $9
) RETURNING id, code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by, approved_by, user_account_id, created_at, updated_at, deleted_at
`

type CreateIdentityParams struct {
	Code               string             `json:"code"`
	FullName           string             `json:"full_name"`
	PhoneNumber        pgtype.Text        `json:"phone_number"`
	IdentityCardNumber pgtype.Text        `json:"identity_card_number"`
	FaceImageUrl       string             `json:"face_image_url"`
	Type               string             `json:"type"`
	Status             NullIdentityStatus `json:"status"`
	Note               pgtype.Text        `json:"note"`
	CreatedBy          pgtype.UUID        `json:"created_by"`
}

func (q *Queries) CreateIdentity(ctx context.Context, arg CreateIdentityParams) (Identity, error) {
	row := q.db.QueryRow(ctx, createIdentity,
		arg.Code,
		arg.FullName,
		arg.PhoneNumber,
		arg.IdentityCardNumber,
		arg.FaceImageUrl,
		arg.Type,
		arg.Status,
		arg.Note,
		arg.CreatedBy,
	)
	var i Identity
	err := row.Scan(
		&i.ID,
		&i.Code,
		&i.FullName,
		&i.PhoneNumber,
		&i.IdentityCardNumber,
		&i.FaceImageUrl,
		&i.Type,
		&i.Status,
		&i.Note,
		&i.CreatedBy,
		&i.ApprovedBy,
		&i.UserAccountID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return i, err
}

const deleteIdentity = `-- name: DeleteIdentity :exec
UPDATE identities
SET deleted_at = NOW(), updated_at = NOW()
WHERE id = $1
`

func (q *Queries) DeleteIdentity(ctx context.Context, id pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteIdentity, id)
	return err
}

const getIdentity = `-- name: GetIdentity :one
SELECT id, code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by, approved_by, user_account_id, created_at, updated_at, deleted_at FROM identities
WHERE id = $1 AND deleted_at IS NULL LIMIT 1
`

func (q *Queries) GetIdentity(ctx context.Context, id pgtype.UUID) (Identity, error) {
	row := q.db.QueryRow(ctx, getIdentity, id)
	var i Identity
	err := row.Scan(
		&i.ID,
		&i.Code,
		&i.FullName,
		&i.PhoneNumber,
		&i.IdentityCardNumber,
		&i.FaceImageUrl,
		&i.Type,
		&i.Status,
		&i.Note,
		&i.CreatedBy,
		&i.ApprovedBy,
		&i.UserAccountID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return i, err
}

const getIdentityByCode = `-- name: GetIdentityByCode :one
SELECT id, code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by, approved_by, user_account_id, created_at, updated_at, deleted_at FROM identities
WHERE code = $1 AND deleted_at IS NULL LIMIT 1
`

func (q *Queries) GetIdentityByCode(ctx context.Context, code string) (Identity, error) {
	row := q.db.QueryRow(ctx, getIdentityByCode, code)
	var i Identity
	err := row.Scan(
		&i.ID,
		&i.Code,
		&i.FullName,
		&i.PhoneNumber,
		&i.IdentityCardNumber,
		&i.FaceImageUrl,
		&i.Type,
		&i.Status,
		&i.Note,
		&i.CreatedBy,
		&i.ApprovedBy,
		&i.UserAccountID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return i, err
}

const listIdentities = `-- name: ListIdentities :many
SELECT id, code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by, approved_by, user_account_id, created_at, updated_at, deleted_at FROM identities
WHERE deleted_at IS NULL
ORDER BY created_at DESC
LIMIT $1 OFFSET $2
`

type ListIdentitiesParams struct {
	Limit  int32 `json:"limit"`
	Offset int32 `json:"offset"`
}

func (q *Queries) ListIdentities(ctx context.Context, arg ListIdentitiesParams) ([]Identity, error) {
	rows, err := q.db.Query(ctx, listIdentities, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Identity
	for rows.Next() {
		var i Identity
		if err := rows.Scan(
			&i.ID,
			&i.Code,
			&i.FullName,
			&i.PhoneNumber,
			&i.IdentityCardNumber,
			&i.FaceImageUrl,
			&i.Type,
			&i.Status,
			&i.Note,
			&i.CreatedBy,
			&i.ApprovedBy,
			&i.UserAccountID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateIdentity = `-- name: UpdateIdentity :one
UPDATE identities
SET full_name = $2, phone_number = $3, face_image_url = $4, updated_at = NOW()
WHERE id = $1 AND deleted_at IS NULL
RETURNING id, code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by, approved_by, user_account_id, created_at, updated_at, deleted_at
`

type UpdateIdentityParams struct {
	ID           pgtype.UUID `json:"id"`
	FullName     string      `json:"full_name"`
	PhoneNumber  pgtype.Text `json:"phone_number"`
	FaceImageUrl string      `json:"face_image_url"`
}

func (q *Queries) UpdateIdentity(ctx context.Context, arg UpdateIdentityParams) (Identity, error) {
	row := q.db.QueryRow(ctx, updateIdentity,
		arg.ID,
		arg.FullName,
		arg.PhoneNumber,
		arg.FaceImageUrl,
	)
	var i Identity
	err := row.Scan(
		&i.ID,
		&i.Code,
		&i.FullName,
		&i.PhoneNumber,
		&i.IdentityCardNumber,
		&i.FaceImageUrl,
		&i.Type,
		&i.Status,
		&i.Note,
		&i.CreatedBy,
		&i.ApprovedBy,
		&i.UserAccountID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return i, err
}

const updateIdentityStatus = `-- name: UpdateIdentityStatus :one
UPDATE identities
SET status = $2, approved_by = $3, updated_at = NOW()
WHERE id = $1 AND deleted_at IS NULL
RETURNING id, code, full_name, phone_number, identity_card_number, face_image_url, type, status, note, created_by, approved_by, user_account_id, created_at, updated_at, deleted_at
`

type UpdateIdentityStatusParams struct {
	ID         pgtype.UUID        `json:"id"`
	Status     NullIdentityStatus `json:"status"`
	ApprovedBy pgtype.UUID        `json:"approved_by"`
}

func (q *Queries) UpdateIdentityStatus(ctx context.Context, arg UpdateIdentityStatusParams) (Identity, error) {
	row := q.db.QueryRow(ctx, updateIdentityStatus, arg.ID, arg.Status, arg.ApprovedBy)
	var i Identity
	err := row.Scan(
		&i.ID,
		&i.Code,
		&i.FullName,
		&i.PhoneNumber,
		&i.IdentityCardNumber,
		&i.FaceImageUrl,
		&i.Type,
		&i.Status,
		&i.Note,
		&i.CreatedBy,
		&i.ApprovedBy,
		&i.UserAccountID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return i, err
}
